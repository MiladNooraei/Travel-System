__name__ = "Ali Etemadfard, Milad Nooraei" 
__email__ = "alietemadfard@gmail.com, miladnooraiy0@gmail.com"

#####################################################################################################################################

#Entity Relation Diagram - open the link below
__doc__ = "https://viewer.diagrams.net/?tags=%7B%7D&highlight=0000ff&edit=_blank&layers=1&nav=1#R7V1bk9o4Fv41VM0%2BQPl%2BeUw6yUxqemtS0zO12X2hhC1A074QWTRNfv1KtgS2JcCADYYiL42OJEuWzvedI%2BnIGZhP8fuvGCzm%2F05DGA0MLXwfmJ8GhqHbjkP%2FMMmaSzTLKyQzjEIu2wpe0E8oCnLpEoUwqxQkaRoRtKgKgzRJYEAqMoBxuqoWm6ZRtdUFmEFJ8BKASJb%2BB4VkXkg9w93Kf4NoNhct645f5MRAFOZvks1BmK5KIvPzwHzCaUqKX%2FH7E4zY6IlxKep92ZG76RiGCWlS4TnxFy8%2Fo2X89pfthS9%2FP%2F34%2Fr%2Bhzd8jI2vxxjCkA8CTKSbzdJYmIPq8lX7E6TIJIXusRlPbMs9puqBCnQr%2FgYSs%2BWyCJUmpaE7iiOfCd0S%2Bs%2Bojm6f%2Byx%2FGfn96LyfWIpEQvP5eTuR1RoYt0tt6eWpbMfzAFIEmJ1EavBaiLygSvZEHko9tli5xAPeNHldIgGeQ7Cln8IJsaEst8Hn6FaYxpD2mBTCMAEFvVd0DXIVnm3LbWaY%2F%2BEQfM%2BnFc99AtOQtEQzeGHJrqpCtUByBhM15MEdR%2BAzW6ZK9aEZA8CpSH%2BcpRj%2FThAAxojQbEz77tlYp8cJq8pnZ6hGrNKX5vI5uiTTvi5Y%2FFKevGxAarD7MaPlvYuK0jegZZER0RaCO5YYgm2%2F0FkRoltDfAa0NMRPggLfPml%2FNEYEvC5ArwIqyW1WFp1R%2FntIoxflImaENvdDa9LKU4xkTk7LgHjV7g5jA9716wXNth3MJZ1PT5%2BnVlpp0UWZeoiVDszvSJUfSpYHhRITPX07MYiicH0vGdXQgzCDQ6L%2ByyJmxv4UejmmL%2FCETLLKEhPayeHJVvK811lYQyK29wTkKIqhsjvJ6EqyP6QnvO1kv4Diko5sRFMiVQ0CgQrrEFPdpIudQ4MyQQh6y5yc7Ki0wChStgDeAIjChb5xBQDIJ7gIREZwSSZWTNOeBst5zUUZBgpLZc17r0wa6HMpGPtCYDgaIPvAGCLMTBVZZdzZ0QAAppSlUBIpLwJNhtJfjDmOLY8luCCXd7gpKrgQlrqAPXj6dlwH0poGKl53Ag5NpO7ys%2B1VetoTBP6RMol7ruuS1SssyUcosDGI2E8kkW5Qocss94hGMHlWUesdU5DZWpyOpyOpKe3RdUp9lRrH44KFTeWjqBTBQ8tDEs618DFrgId%2Br8ZDT1D80O1Mlo1UmYmp4KfcQpzt8wxBlAVVNosykfmO4o4%2BST7mjs6xGCWaiX5MU0ycP%2BTt8yAcV%2FzIcluX%2Fyh%2Bjlcrg2eQXQ7MGBp0%2FNqL5n6JY%2FYWnCGdknIBYwdAR2Jk1QZjMx2rHdjGnxDxOlvGE0Uc9F8bUIR2DMKSwzBSVQZat6MspRjIoJoAWoAvvezYeenMSONaR9brCvGHJGwwoeFXM1MOANDYg06mhNiChM3HsljYYPK1qQIymGwy61pkyybtV55D6TgMibT3sIWduH3LGu2Pu2eC4de6xu9IWU96PypaLRYrJOFtnBMYPCjqDgqCzg4Jcf6K15cPaVQryvKvbM1PemTnHh42ps0NdwWOo5hzGY14UTGYV2uu0QQo42hgIY5Qc02QGYTKmqCJLhSv4Y8n2O1V7nSInd0DHBFU91LPc6PqLgSRbqdzYQl7uwB0bhQ3Dtu%2BQdrYIteT9DLa4e9iCk20B1EMbuipb4DuuCVpyR3XTqBoDW2%2BoS51trFrt7mfs3GPYQZt5eYIiotDee2IZq7Nlb2ebppYtzcglQykGpUCKTVjFgVAKfXBcKMVOSB%2BMlLDMouDBUAmxX9iTUAnLueak6qdM6jnxMSCDn6jNGJRDZC408VbPJt6UeH4O5CNzam4X7Ceep%2FGEOq6U9iCmLmBuYYX021Z0yMxKRroNK6rXjgVsS8GVhoIrna640r49WA21kWbUCNM03IPgoqnS%2FJ%2BJJrspmpxegcmWwfSFOh0Roh4DvE1Qmb45siuostyro8rvD6qMptZqZFcwdQBP%2BUqrHs6ZC0sBnSWLxn3ctqyZ0TTiUxzb9ASAzg2G%2BY5Ms0K3%2BkjTzVPotjt1cK7n1eZV6WuBdanAIkVJEdfHn%2FyNCUp7q7X4UbceMl4rr2uGua8C%2FVF0YauZm3c5Q1m9%2Fiir3lhZfausrMxb0M9U1raj1Rtrq9kv78GRvQcMA0jbvU3Xwa8dsrqWIlrwoo6Dc1V3%2FETEuUc5DmfAxrpR2MhRGBmlktvEjK65vQPNdff7TgPNUZjpznES%2FtDhdazVC8dJUj%2FHNw54TnV95Z7Uzgqb0y91hY5cLV%2FiiCJIUSaJx9FYw6OxCQi80BwojsYM07LssB1CrF8Fc7WGVw70zq6CCY1v6Wjs%2BBtY5wQt8NZikIDZcSHGvGYRG3vHR3Ibrmg%2FGqwzjdSlGen%2FhljFQo%2BOOL1p2UZ7DU202NztidvrWg%2B37NQpdxu7ZX6%2F5tyQLE%2FAXAyU3OZqx64d2Dmq%2B4QXXey45r2jqnKyEEQgy1AwuOTZgtMQe0LZ%2B4I9OT5f3I96LCJOX0Ro0ISOahGhQU%2FzvHZ4Rjdrq1RDdYZpq1YRemdM0%2B4XJfbe1etgHVG7X9KzG36b0aA2j%2Bkp%2B%2FjRPa9Z3FY%2BA6ECQHeW9qqH%2BCeFEWojz%2FXKtpadfmn%2BQTf2ome1rtvQvvbs6F64gn1YwzbWB8uv%2BF76SPO9U9ThAtPt9uvUxpXvGhV7Uje5kJFCD03%2FgiuZ%2BPMfrx%2B%2Bvhmrv9106MTv%2F0R%2FPg3lqyDFjf2Hs3r6R3a0AEJD5azajq27sC1n1aqtilVhrF1dBlHqkrztcI6ruufLETvcSV6DoDu6DrIXtL28DaLs8VUPh08OcNarWyYjcxPUdHEnTjmqigimffpyeZuu7M11gy%2BP0IWzJ6blY3rFKXndBrg1ABeqwavV5u24A%2FN971lifHSbW8ySZ6a0pl15Znbs%2FvllOoSh9sdfXz%2FGv2dfx%2BPhdbeYT6HMY%2B%2FPtUKMyrFrenAj4HJ5ZlR2%2BzatpFWzkp5zvb2Os7ShL2HpZvUmjePZZc06XJ7Hr7YVKrVvTKV1%2BW3Sv1uPZ7O7W5fT5PYr98V0bP%2BzAPPz%2FwE%3D"

#####################################################################################################################################

#importing libraries
import re
import random
import decimal
import hashlib
import pandas as pd
import tkinter as tk
import seaborn as sns
import mysql.connector
from pandastable import Table
from datetime import datetime
from tkinter import messagebox
import matplotlib.pyplot as plt
from tkinter import Label, font

#####################################################################################################################################

#connecting to database
my_database = mysql.connector.connect(
  host = "127.0.0.1",
  port = "3306",
  user = "root",
  password = Your_password,
  auth_plugin = "mysql_native_password",
  database = "travel_system"
)

#creating tables if they don't exist
cursor = my_database.cursor()

#vehicle Table
cursor.execute("SHOW TABLES LIKE 'vehicle'")
table_exists = cursor.fetchone()
if not table_exists:
    query = """
        CREATE TABLE vehicle (
        vehicle_id INT PRIMARY KEY NOT NULL,
        vehicle_type VARCHAR(10) NOT NULL
        )
    """
    cursor.execute(query)
    my_database.commit()

    insert_query = """
        INSERT INTO vehicle (vehicle_id, vehicle_type)
        VALUES (%s, %s)
    """
    cursor.executemany(insert_query, [(101, "Bus"), (102, "AirPlane"), (103, "Train"), (104, "Ship")])
    my_database.commit()

#gender table
cursor.execute("SHOW TABLES LIKE 'gender'")
table_exists = cursor.fetchone()
if not table_exists:
    create_table_query = """
        CREATE TABLE gender (
        gender_id INT PRIMARY KEY NOT NULL,
        gender_title VARCHAR(10) NOT NULL
        )
    """
    cursor.execute(create_table_query)

    insert_data_query = """
        INSERT INTO gender (gender_id, gender_title)
        VALUES (1, 'Male'), (2, 'Female'), (3, 'N/A')
    """
    cursor.execute(insert_data_query)
    my_database.commit()

#role table
cursor.execute("SHOW TABLES LIKE 'role'")
table_exists = cursor.fetchone()
if not table_exists:
    query = """
        CREATE TABLE role (
        role_id INT PRIMARY KEY NOT NULL,
        role_title VARCHAR(25) NOT NULL
        )
    """
    cursor.execute(query)

    insert_query = """
        INSERT INTO role (role_id, role_title) VALUES (%s, %s)
    """
    cursor.executemany(insert_query, [(1, "passenger"), (2, "travel_agency_manager"), (3, "super_admin")])
    my_database.commit()

#discount table
cursor.execute("SHOW TABLES LIKE 'discount'")
table_exists = cursor.fetchone()
if not table_exists:
    query = """
        CREATE TABLE discount (
        discount_id INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
        discount_percentage INT NOT NULL
        )
    """
    cursor.execute(query)
    insert_query = """
        INSERT INTO discount (discount_id, discount_percentage)
        VALUES (1, 0)
    """
    cursor.execute(insert_query)

#user table
cursor.execute("SHOW TABLES LIKE 'user'")
table_exists = cursor.fetchone()
if not table_exists:
    query = """
        CREATE TABLE user (
        user_id INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
        role_id INT NOT NULL,
        discount_id INT NOT NULL,
        gender_id INT NOT NULL,
        first_name VARCHAR(30) NOT NULL,
        last_name VARCHAR(30) NOT NULL,
        birth_date DATE NOT NULL,
        phone_number VARCHAR(13) NOT NULL,
        email_address VARCHAR(60) NOT NULL,
        password VARCHAR(225) NOT NULL,
        account_asset INT NOT NULL,
        FOREIGN KEY (role_id) REFERENCES role(role_id),
        FOREIGN KEY (discount_id) REFERENCES discount(discount_id),
        FOREIGN KEY (gender_id) REFERENCES gender(gender_id)
        )
    """
    cursor.execute(query)

#agency Table
cursor.execute("SHOW TABLES LIKE 'agency'")
table_exists = cursor.fetchone()
if not table_exists:
    query = """
        CREATE TABLE agency (
        agency_id INT AUTO_INCREMENT PRIMARY KEY NOT NULL,
        agency_name VARCHAR(25) NOT NULL,
        agency_manager_id INT,
        FOREIGN KEY (agency_manager_id) REFERENCES user(user_id)
        );
    """
    cursor.execute(query)
    my_database.commit()

#travel table
cursor.execute("SHOW TABLES LIKE 'travel'")
table_exists = cursor.fetchone()
if not table_exists:
    query = """
        CREATE TABLE travel (
        travel_id INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
        vehicle_id INT NOT NULL,
        agency_id INT NOT NULL,
        travel_type_domestic BOOLEAN NOT NULL,
        date DATE NOT NULL,
        duration INT NOT NULL,
        origin VARCHAR(30) NOT NULL,
        destination VARCHAR(30) NOT NULL,
        price DECIMAL(10, 2) NOT NULL,
        available_seats INT NOT NULL,
        FOREIGN KEY (vehicle_id) REFERENCES vehicle (vehicle_id),
        FOREIGN KEY (agency_id) REFERENCES agency (agency_id)
        )
    """
    cursor.execute(query)

#ticket table
cursor.execute("SHOW TABLES LIKE 'ticket'")
table_exists = cursor.fetchone()
if not table_exists:
    query = """
        CREATE TABLE ticket (
        user_id INT NOT NULL,
        travel_id INT NOT NULL,
        rate INT CHECK (rate BETWEEN 1 AND 5),
        FOREIGN KEY (user_id) REFERENCES user(user_id),
        FOREIGN KEY (travel_id) REFERENCES travel(travel_id)
        )
    """
    cursor.execute(query)

#support_system table
cursor.execute("SHOW TABLES LIKE 'support_system'")
table_exists = cursor.fetchone()
if not table_exists:
    query = """
        CREATE TABLE support_system (
        message_id INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
        passenger_id INT,
        super_admin_id INT,
        seen_status BOOLEAN,
        question VARCHAR(255),
        question_date_time DATETIME,
        answer VARCHAR(255),
        answer_date_time DATETIME,
        FOREIGN KEY (passenger_id) REFERENCES user(user_id),
        FOREIGN KEY (super_admin_id) REFERENCES user(user_id)
        )
    """
    cursor.execute(query)

#####################################################################################################################################

#login page
def login():
    user_username = username_entry.get()
    user_password = password_entry.get()
    generate_hash = lambda name : hashlib.sha256(name.encode("utf-8")).hexdigest()
    hashed_password = generate_hash(user_password)
    #finding user if exists
    query = "SELECT user_id, role_id, phone_number, email_address, password FROM user WHERE (phone_number = %s OR email_address = %s) AND password = %s" 
    cursor.execute(query, (user_username, user_username, hashed_password)) 
    rows = cursor.fetchall() 
    user_list = [] 
    for row in rows: 
        user_id, role_id, phone_number, email_address, password = row 
        user_list.append((user_id, role_id, phone_number, email_address, password)) 
    if user_list == []:
        messagebox.showerror("Error", "User not found! \U0001F612 \nMake sure of validity of your UserName and your Password!")
    else:        
        role_id = user_list[0][1]
        #going to user panel based on role
        if role_id == 1:
            passenger_dashboard(user_list[0][0])
        elif role_id == 2:
            travel_agency_dashboard(user_list[0][0]) 
        elif role_id == 3:
            super_admin_dashboard(user_list[0][0])

#####################################################################################################################################

#passengers dashboard
def passenger_dashboard(user_id):
    #list of available cities
    cities = [
        "Tehran", "Mashhad", "Isfahan", "Karaj", "Tabriz", "Shiraz", "Qom", "Ahvaz", "Kermanshah", "Urmia",
        "Rasht", "Zahedan", "Kerman", "Hamedan", "Yazd", "Arak", "Ardabil", "Bandar Abbas", "Qazvin", "Zanjan",
        "New York City", "London", "Paris", "Tokyo", "Berlin", "Sydney", "Rome", "Beijing", "Moscow", "Cairo",
        "Dubai", "Toronto", "Bangkok", "Istanbul", "Amsterdam", "Rio de Janeiro", "Cape Town", "Mumbai",
        "Buenos Aires", "Singapore"
    ]
    def Buy(travel_id, discount):  
        id = int(travel_id.get())
        cursor = my_database.cursor() 
        query = "SELECT available_seats, price FROM travel WHERE travel_id = %s" 
        cursor.execute(query, (id, )) 
        result = cursor.fetchone()
        pay_price = result[1]
        if discount == "":
            pay_price = result[1]
            query = "SELECT account_asset FROM user WHERE user_id = %s" 
            cursor.execute(query, (user_id, )) 
            current_asset = cursor.fetchone()
            #checking if travel seats are full and if tuition can be payed or not
            if result[0] == 0:
                messagebox.showerror("Error", "Travel seats are full! \U0001F612")
            else:
                if current_asset[0] >= pay_price:
                    query = "UPDATE travel SET available_seats = available_seats - 1 WHERE travel_id = %s" 
                    cursor.execute(query, (id, )) 
                    my_database.commit()
                    query = "UPDATE user SET account_asset = account_asset - %s WHERE user_id = %s" 
                    cursor.execute(query, (int(pay_price), user_id)) 
                    my_database.commit()
                    query = "INSERT INTO ticket (user_id, travel_id, rate) VALUES (%s, %s, %s)" 
                    cursor.execute(query, (user_id, id, None)) 
                    my_database.commit()
                    messagebox.showinfo("Success", "Ticket is booked! \U0001F607")
                else:
                    messagebox.showerror("Error", "Your asset amount is not enough! \U0001F612")
        #checking if the passenger has discount code
        else:
            cursor = my_database.cursor() 
            query = """ 
            SELECT discount.discount_percentage 
            FROM discount
            WHERE discount.discount_id = %s 
            """ 
            cursor.execute(query, (discount, )) 
            discount_num = cursor.fetchone()
            if type(discount_num) == type(None):
                messagebox.showerror("Error", "Invalid discount code! \U0001F612")
            else:
                pay_price = result[1] - (result[1] * discount_num[0] / 100)
                query = "SELECT account_asset FROM user WHERE user_id = %s" 
                cursor.execute(query, (user_id, )) 
                current_asset = cursor.fetchone()
                #checking if travel seats are full and if tuition can be payed or not
                if result[0] == 0:
                    messagebox.showerror("Error", "Travel seats are full! \U0001F612")
                else:
                    if current_asset[0] >= pay_price:
                        query = "UPDATE travel SET available_seats = available_seats - 1 WHERE travel_id = %s" 
                        cursor.execute(query, (id, )) 
                        my_database.commit()
                        query = "UPDATE user SET account_asset = account_asset - %s WHERE user_id = %s" 
                        cursor.execute(query, (int(pay_price), user_id)) 
                        my_database.commit()
                        query = "INSERT INTO ticket (user_id, travel_id, rate) VALUES (%s, %s, %s)" 
                        cursor.execute(query, (user_id, id, 0)) 
                        my_database.commit()
                        messagebox.showinfo("Success", "Ticket is booked! \U0001F607")
                    else:
                        messagebox.showerror("Error", "Your asset amount is not enough! \U0001F612")

    def travel_Origin_Destination():
        def show_result():
            #finding travels based on filters
            show_result_page = tk.Toplevel(travel_Origin_Destination_page) 
            origin = origin_var.get() 
            destination = destination_var.get() 
            query = """ 
                SELECT travel.travel_id, travel.travel_type_domestic, travel.date, travel.duration, travel.price, travel.available_seats, vehicle.vehicle_type, agency.agency_name 
                FROM travel JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id JOIN agency ON travel.agency_id = agency.agency_id 
                WHERE travel.origin = %s AND travel.destination = %s 
            """ 
            cursor.execute(query, (origin, destination)) 
            rows = cursor.fetchall()
            column_names = [desc[0] for desc in cursor.description] 
            origin_destination_df = pd.DataFrame(rows, columns = column_names)
            origin_destination_df["travel_type_domestic"] = origin_destination_df["travel_type_domestic"].replace({1 : True, 0 : False})
            frame = tk.Frame(show_result_page) 
            frame.grid(row = 0, column = 0) 
            table = Table(frame, dataframe = origin_destination_df, showtoolbar = True, showstatusbar = True) 
            table.show()
            tk.Label(show_result_page, text = "Enter travel ID of which you want to buy : ").grid(row = 1, column = 0)
            travel_id = tk.Entry(show_result_page)
            travel_id.grid(row = 1, column = 1)
            tk.Label(show_result_page, text = "Enter disscount code if you have : ").grid(row = 2, column = 0)
            discount = tk.Entry(show_result_page)
            discount.grid(row = 2, column = 1)
            tk.Button(show_result_page, text = "Buy", command = lambda : Buy(travel_id, discount.get())).grid(row = 3, column = 1)

        travel_Origin_Destination_page = tk.Toplevel(passenger_dashboard_page)
        origin_list = cities
        origin_var = tk.StringVar(travel_Origin_Destination_page)
        origin_var.set(origin_list[0])
        origin_label = tk.Label(travel_Origin_Destination_page, text = "Choose origin : ").grid(row = 1, column = 1)
        origin_option = tk.OptionMenu(travel_Origin_Destination_page, origin_var, *origin_list)
        origin_option.grid(row = 1, column = 2)
        destination_list = cities
        destination_var = tk.StringVar(travel_Origin_Destination_page)
        destination_var.set(destination_list[0])
        destination_label = tk.Label(travel_Origin_Destination_page, text = "Choose destination : ").grid(row = 2, column = 1)
        destination_option = tk.OptionMenu(travel_Origin_Destination_page, destination_var, *destination_list)
        destination_option.grid(row = 2, column = 2)
        tk.Button(travel_Origin_Destination_page, text = "Search", command = show_result).grid(row = 3, column = 0)
    
    def travel_Origin_Destination_Date():
        #finding travels based on filters
        def show_result():
            show_result_page = tk.Toplevel(travel_Origin_Destination_page)
            origin = origin_var.get() 
            destination = destination_var.get() 
            date = str(year_var.get()) + "-" + str(month_var.get()) + "-" + str(day_var.get())
            date_obj = datetime.strptime(date, "%Y-%B-%d") 
            formatted_date = date_obj.strftime("%Y-%m-%d")
            query = """ 
                SELECT travel.travel_id, travel.travel_type_domestic, travel.date, travel.duration, travel.price, travel.available_seats, vehicle.vehicle_type, agency.agency_name 
                FROM travel JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id JOIN agency ON travel.agency_id = agency.agency_id 
                WHERE travel.origin = %s AND travel.destination = %s AND travel.date = %s 
            """ 
            cursor.execute(query, (origin, destination, formatted_date)) 
            rows = cursor.fetchall()  
            column_names = [desc[0] for desc in cursor.description] 
            origin_destination_df = pd.DataFrame(rows, columns = column_names)
            origin_destination_df["travel_type_domestic"] = origin_destination_df["travel_type_domestic"].replace({1 : True, 0 : False})
            frame = tk.Frame(show_result_page) 
            frame.grid(row = 0, column = 0) 
            table = Table(frame, dataframe = origin_destination_df, showtoolbar = True, showstatusbar = True) 
            table.show() 
            tk.Label(show_result_page, text = "Enter travel ID of which you want to buy : ").grid(row = 1, column = 0)
            travel_id = tk.Entry(show_result_page)
            travel_id.grid(row = 1, column = 1)
            tk.Button(show_result_page, text = "Buy", command = lambda : Buy(travel_id)).grid(row = 2, column = 0)

        travel_Origin_Destination_page = tk.Toplevel(passenger_dashboard_page)
        origin_list = cities
        origin_var = tk.StringVar(travel_Origin_Destination_page)
        origin_var.set(origin_list[0])
        origin_label = tk.Label(travel_Origin_Destination_page, text = "Choose origin : ").grid(row = 1, column = 1)
        origin_option = tk.OptionMenu(travel_Origin_Destination_page, origin_var, *origin_list)
        origin_option.grid(row = 1, column = 2)
        destination_list = cities
        destination_var = tk.StringVar(travel_Origin_Destination_page)
        destination_var.set(destination_list[0])
        destination_label = tk.Label(travel_Origin_Destination_page, text = "Choose destination : ").grid(row = 2, column = 1)
        destination_option = tk.OptionMenu(travel_Origin_Destination_page, destination_var, *destination_list)
        destination_option.grid(row = 2, column = 2)

        year = list(range(2023, 1939, -1))
        year_var = tk.StringVar(travel_Origin_Destination_page)
        year_var.set(year[0])
        tk.Label(travel_Origin_Destination_page, text = "Select Year : ").grid(row = 3, column = 1)
        year_option = tk.OptionMenu(travel_Origin_Destination_page, year_var, *year)
        year_option.grid(row = 3, column = 2)
        months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
        month_var = tk.StringVar(travel_Origin_Destination_page)
        month_var.set(months[0])
        tk.Label(travel_Origin_Destination_page, text = "Select Month:").grid(row = 4, column = 1)
        month_option = tk.OptionMenu(travel_Origin_Destination_page, month_var, *months)
        month_option.grid(row = 4, column = 2)
        day = list(range(1, 32))
        day_var = tk.StringVar(travel_Origin_Destination_page)
        day_var.set(day[0])
        tk.Label(travel_Origin_Destination_page, text = "Select Day:").grid(row = 5, column = 1)
        day_option = tk.OptionMenu(travel_Origin_Destination_page, day_var, *day)
        day_option.grid(row = 5, column = 2)
        tk.Button(travel_Origin_Destination_page, text = "Search", command = show_result).grid(row = 6, column = 0)

    def travel_Origin_Destination_Date_vehicle():
        #finding travels based on filters
        def show_result():
            show_result_page = tk.Toplevel(travel_Origin_Destination_page)
            origin = origin_var.get() 
            destination = destination_var.get() 
            date = str(year_var.get()) + "-" + str(month_var.get()) + "-" + str(day_var.get())
            date_obj = datetime.strptime(date, "%Y-%B-%d") 
            formatted_date = date_obj.strftime("%Y-%m-%d")
            vehicle=vehicle_var.get()
            query = """
                SELECT travel.travel_id, travel.travel_type_domestic, travel.date, travel.duration, travel.price, travel.available_seats, vehicle.vehicle_type, agency.agency_name
                FROM travel JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id JOIN agency ON travel.agency_id = agency.agency_id    
                WHERE travel.origin = %s AND travel.destination = %s AND travel.date = %s AND vehicle.vehicle_type = %s 
            """
            cursor.execute(query, (origin, destination, formatted_date, vehicle))
            rows = cursor.fetchall()  
            column_names = [desc[0] for desc in cursor.description] 
            filtered_df = pd.DataFrame(rows, columns = column_names)
            filtered_df["travel_type_domestic"] = filtered_df["travel_type_domestic"].replace({1 : True, 0 : False})
            frame = tk.Frame(show_result_page) 
            frame.grid(row = 0, column = 0) 
            table = Table(frame, dataframe = filtered_df, showtoolbar = True, showstatusbar = True) 
            table.show() 
            tk.Label(show_result_page, text = "Enter travel ID of which you want to buy : ").grid(row = 1, column = 0)
            travel_id = tk.Entry(show_result_page)
            travel_id.grid(row = 1, column = 1)
            tk.Button(show_result_page, text = "Buy", command = lambda : Buy(travel_id)).grid(row = 2, column = 0)

        travel_Origin_Destination_page = tk.Toplevel(passenger_dashboard_page)
        origin_list = cities
        origin_var = tk.StringVar(travel_Origin_Destination_page)
        origin_var.set(origin_list[0])
        origin_label = tk.Label(travel_Origin_Destination_page, text = "Choose origin : ").grid(row = 1, column = 1)
        origin_option = tk.OptionMenu(travel_Origin_Destination_page, origin_var, *origin_list)
        origin_option.grid(row = 1, column = 2)
        destination_list = cities
        destination_var = tk.StringVar(travel_Origin_Destination_page)
        destination_var.set(destination_list[0])
        destination_label = tk.Label(travel_Origin_Destination_page, text = "Choose destination : ").grid(row = 2, column = 1)
        destination_option = tk.OptionMenu(travel_Origin_Destination_page, destination_var, *destination_list)
        destination_option.grid(row = 2, column = 2)

        year = list(range(2023, 1939, -1))
        year_var = tk.StringVar(travel_Origin_Destination_page)
        year_var.set(year[0])
        tk.Label(travel_Origin_Destination_page, text = "Select Year : ").grid(row = 3, column = 1) 
        year_option = tk.OptionMenu(travel_Origin_Destination_page, year_var, *year)
        year_option.grid(row = 3, column = 2)
        months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
        month_var = tk.StringVar(travel_Origin_Destination_page)
        month_var.set(months[0])
        tk.Label(travel_Origin_Destination_page, text = "Select Month : ").grid(row = 4, column = 1) 
        month_option = tk.OptionMenu(travel_Origin_Destination_page, month_var, *months)
        month_option.grid(row = 4, column = 2)
        day = list(range(1, 32))
        day_var = tk.StringVar(travel_Origin_Destination_page)
        day_var.set(day[0])
        tk.Label(travel_Origin_Destination_page, text = "Select Day : ").grid(row = 5, column = 1)
        day_option = tk.OptionMenu(travel_Origin_Destination_page, day_var, *day)
        day_option.grid(row = 5, column = 2)

        vehicle_list = ["Bus", "AirPlane", "Train", "Ship"]
        vehicle_var = tk.StringVar(travel_Origin_Destination_page)
        vehicle_var.set(vehicle_list[0])
        vehicle_label = tk.Label(travel_Origin_Destination_page, text = "Select vehicle : ").grid(row = 6, column = 1)
        vehicle_option = tk.OptionMenu(travel_Origin_Destination_page, vehicle_var, *vehicle_list)
        vehicle_option.grid(row = 6, column = 2)
        tk.Button(travel_Origin_Destination_page, text = "Search", command = show_result).grid(row = 7, column = 0)  

    #seeing all passengers travel history and rating them
    def passenger_history():
        def rate():
            def save():
                rate=rate_var.get()
                the_travel_id=travel_id.get()
                cursor = my_database.cursor()
                update_query = "UPDATE ticket SET rate = %s WHERE travel_id = %s AND user_id = %s"
                cursor.execute(update_query, (rate, int(the_travel_id), user_id))
                my_database.commit()
                messagebox.showinfo("Success","Thank you!\nYour rating is recorded! \U0001F607")
                frame.destroy
            rates = list(range(1, 6))
            rate_var = tk.StringVar(frame)
            rate_var.set(rates[0])
            tk.Label(frame, text = "Rate the travel : ", fg = "#193750").grid(row = 3, column = 1)
            rate_option = tk.OptionMenu(frame, rate_var, *rates)
            rate_option.grid(row = 3, column = 2)
            tk.Button(frame, text = "Rate", command = save).grid(row = 3, column = 3)
            tk.Label(frame, text = "                                            ").grid(row = 4, column = 1)
        query = """
            SELECT travel.travel_id, ticket.rate, travel.vehicle_id, travel.agency_id, travel.travel_type_domestic, travel.date, travel.duration, travel.origin, travel.destination, travel.price, vehicle.vehicle_type, agency.agency_name
            FROM ticket JOIN travel ON ticket.travel_id = travel.travel_id JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id JOIN agency ON travel.agency_id = agency.agency_id
            WHERE ticket.user_id = %s
        """
        cursor = my_database.cursor()
        cursor.execute(query, (user_id, ))
        result = cursor.fetchall()
        columns = [column[0] for column in cursor.description]
        filtered_df = pd.DataFrame(result, columns = columns)
        filtered_df["travel_type_domestic"] = filtered_df["travel_type_domestic"].replace({1 : True, 0 : False})
        passenger_history_page=tk.Toplevel(passenger_dashboard_page)
        frame = tk.Frame(passenger_history_page) 
        frame.grid(row = 0, column = 0)
        table = Table(frame, dataframe = filtered_df, showtoolbar = True, showstatusbar = True) 
        table.show()
        tk.Label(frame, text = "Enter travel ID of which you want to rate : ", fg = "#193750").grid(row = 2, column = 1)
        travel_id = tk.Entry(frame)
        travel_id.grid(row = 2, column = 2)
        tk.Button(frame, text = "Choose", command = rate).grid(row = 2, column = 3)

    #updating account asset
    def charge_account():
        def pay():
            cursor = my_database.cursor() 
            query = "SELECT user.account_asset FROM user where user.user_id = %s" 
            cursor.execute(query, (user_id, )) 
            current_amount = cursor.fetchall() 
            amount = amount_entry.get()
            query = "UPDATE user SET account_asset = %s WHERE user_id = %s"
            cursor.execute(query, (current_amount[0][0] + int(amount), user_id))
            my_database.commit()
            messagebox.showinfo("Success", "Account charged successfully! \U0001F607 \nYour current amount is : " + str(current_amount[0][0] + int(amount)))
        passenger_charge_page = tk.Toplevel(passenger_dashboard_page)
        tk.Label(passenger_charge_page, text = "Amount(in $USD) : ").grid(row = 0, column = 0)
        amount_entry = tk.Entry(passenger_charge_page)
        amount_entry.grid(row = 0, column = 1)
        tk.Button(passenger_charge_page, text = "Pay", command = pay).grid(row = 1, column = 0)
    
    #deleting account
    def delete_account():
        cursor = my_database.cursor() 
        cursor.execute("SET FOREIGN_KEY_CHECKS = 0") 
        delete_query = "DELETE FROM user WHERE user_id = %s" 
        cursor.execute(delete_query, (user_id, )) 
        my_database.commit() 
        cursor.execute("SET FOREIGN_KEY_CHECKS = 1")
        messagebox.showinfo("Delete", "Account deleted!")    
        passenger_dashboard_page.destroy

    #support(chatting) system for passengers questions
    def support_system():
        def chats():
            cursor = my_database.cursor() 
            query = "SELECT * FROM support_system WHERE passenger_id = %s" 
            cursor.execute(query, (user_id, )) 
            rows = cursor.fetchall() 
            query = "SELECT first_name, last_name FROM user WHERE user_id = %s" 
            cursor.execute(query, (user_id, )) 
            result = cursor.fetchone() 
            passenger_name = result[0] + " " + result[1]
            texts = "" 
            for i in rows:
                seen_status_mapping = {0 : "Not Seen", 1 : "Seen"}  
                seen_status = seen_status_mapping.get(i[3], None)
                if i[7] == None:
                    asn_dt = ""
                else:
                    asn_dt = str(i[7])

                if i[6] == None:
                    ans = ""
                else:
                    ans = i[6]
            
                if i[2] == None:
                    super_admin_name = ""
                else:
                    query = "SELECT first_name, last_name FROM user WHERE user_id = %s" 
                    cursor.execute(query, (i[2], )) 
                    result = cursor.fetchone() 
                    super_admin_name = result[0] + " " + result[1]
                #creating text ticket
                texts += passenger_name +  " : " + "<<" + str(i[5]) + " - " + seen_status + ">>\n" + i[4] + "\n" + super_admin_name + " : <<" + asn_dt + ">>\n" + ans +"\n\n"
            tk.Label(support_system_page, text = texts).grid(row = 0, column = 0, sticky = tk.W)

        #panel for asking question
        def ask():
            if question_entry.get() == "":
                messagebox.showerror("Error", "Message is empty! \U0001F612")
            else:
                cursor = my_database.cursor() 
                query = "INSERT INTO support_system (passenger_id, seen_status, question, question_date_time) VALUES (%s, %s, %s, %s)" 
                cursor.execute(query, (user_id, 0, str(question_entry.get()), datetime.now())) 
                my_database.commit()
                messagebox.showinfo("Success", "Message sent! \U0001F607")

        support_system_page = tk.Toplevel(passenger_dashboard_page)
        tk.Label(support_system_page, text = "Ask new question : ").grid(row = 1, column = 0)
        question_entry = tk.Entry(support_system_page)
        question_entry.grid(row = 1, column = 1)
        tk.Button(support_system_page, text = "Ask", command = ask).grid(row = 2, column = 1)
        tk.Button(support_system_page, text = "Chats", command = chats).grid(row = 2, column = 0)
    
    #personal information page
    def personal_info_page():
        query = """ 
        SELECT user.first_name, user.last_name, gender.gender_title, user.birth_date, user.phone_number, user.email_address, user.password, user.account_asset 
        FROM user JOIN gender ON user.gender_id = gender.gender_id 
        WHERE user.user_id = %s
        """ 
        cursor.execute(query, (user_id, ))
        result = cursor.fetchall()
        passenger_info_page = tk.Toplevel(passenger_dashboard_page)
        tk.Label(passenger_info_page, text = "First Name : " + result[0][0]).grid(row = 0, column = 0,sticky = tk.W)
        tk.Label(passenger_info_page, text = "Last Name : " + result[0][1]).grid(row = 1, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Gender : " + result[0][2]).grid(row = 2, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Birth Date : " + str(result[0][3])).grid(row = 3, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Phone Number : " + result[0][4]).grid(row = 4, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Email Address : " + result[0][5]).grid(row = 5, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Account Asset : " + str(result[0][7])).grid(row = 6, column = 0, sticky = tk.W)

    passenger_dashboard_page = tk.Toplevel(root)
    tk.Button(passenger_dashboard_page, text = "Personal information", command = personal_info_page, bg = "#DCEDC8").grid(row = 0, column = 0)
    tk.Button(passenger_dashboard_page, text = "Charge Account", command = charge_account, bg = "#DCEDC8").grid(row = 0, column = 1)
    tk.Button(passenger_dashboard_page, text = "Travel History", command = passenger_history, bg = "#DCEDC8").grid(row = 0, column = 2)
    tk.Button(passenger_dashboard_page, text = "Support System", command = support_system, bg = "#DCEDC8").grid(row = 0, column = 3)
    tk.Label(passenger_dashboard_page, text = "Reserve Ticket By : ").grid(row = 1, column = 0)
    tk.Button(passenger_dashboard_page, text = "Origin_Destination", command = travel_Origin_Destination, bg = "#42B3D5").grid(row = 2, column = 0)
    tk.Button(passenger_dashboard_page, text = "Origin_Destination_Date", command = travel_Origin_Destination_Date, bg = "#42B3D5").grid(row = 2, column = 1)
    tk.Button(passenger_dashboard_page, text = "Origin_Destination_Date_Vehicle", command = travel_Origin_Destination_Date_vehicle, bg = "#42B3D5").grid(row = 2, column = 2)
    tk.Button(passenger_dashboard_page, text = "Delete Account", command = delete_account, bg = "LightCoral").grid(row = 3, column = 0)

#####################################################################################################################################

#super admin dashboard
def super_admin_dashboard(user_id):
    def questions():
        def submit():
             #receiving questions and answering them
             if answer_entry.get() == "":
                 messagebox.showerror("Error", "Answer is empty! \U0001F612")
             else:
                cursor = my_database.cursor() 
                sql = "UPDATE support_system SET super_admin_id = %s, seen_status = %s, answer = %s, answer_date_time = %s WHERE message_id = %s" 
                cursor.execute(sql, (user_id, 1, answer_entry.get(), datetime.now(), question_entry.get())) 
                my_database.commit()
                messagebox.showinfo("Success", "Answer submitted! \U0001F607")
        #showing questions
        questions_page = tk.Toplevel(super_admin_dashboard_page)
        cursor = my_database.cursor() 
        query = "SELECT * FROM support_system" 
        cursor.execute(query) 
        rows = cursor.fetchall() 
        column_names = [desc[0] for desc in cursor.description] 
        chat_platform = pd.DataFrame(rows, columns = column_names)
        frame = tk.Frame(questions_page) 
        frame.grid(row = 0, column = 0)
        table = Table(frame, dataframe = chat_platform, showtoolbar = True, showstatusbar = True) 
        table.show()
        #choosing question to answer
        tk.Label(questions_page, text = "Enter the question ID which you want to answer : ").grid(row = 1, column = 0)
        question_entry = tk.Entry(questions_page)
        question_entry.grid(row = 1, column = 1)
        #giving answer answer
        tk.Label(questions_page, text = "Your answer : ").grid(row = 2, column = 0)
        answer_entry = tk.Entry(questions_page)
        answer_entry.grid(row = 2, column = 1)
        tk.Button(questions_page, text = "Submit", command = submit).grid(row = 2, column = 2)

    #super admins information
    def personal_info_page():
        query = """ 
        SELECT user.first_name, user.last_name, gender.gender_title, user.birth_date, user.phone_number, user.email_address, user.password, user.account_asset 
        FROM user JOIN gender ON user.gender_id = gender.gender_id 
        WHERE user.user_id = %s
        """ 
        cursor.execute(query, (user_id, ))
        result = cursor.fetchall()
        passenger_info_page = tk.Toplevel(super_admin_dashboard_page)
        tk.Label(passenger_info_page, text = "*** Super Admin ***", font = font.Font(weight = "bold")).grid(row = 0, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "First Name : " + result[0][0]).grid(row = 1, column = 0,sticky = tk.W)
        tk.Label(passenger_info_page, text = "Last Name : " + result[0][1]).grid(row = 2, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Gender : " + result[0][2]).grid(row = 3, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Birth Date : " + str(result[0][3])).grid(row = 4, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Phone Number : " + result[0][4]).grid(row = 5, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Email Address : " + result[0][5]).grid(row = 6, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Account Asset : " + str(result[0][7])).grid(row = 7, column = 0, sticky = tk.W)
    super_admin_dashboard_page = tk.Toplevel(root)
    tk.Button(super_admin_dashboard_page, text = "Personal information", command = personal_info_page, bg = "#DCEDC8").grid(row = 0, column = 0)
    tk.Button(super_admin_dashboard_page, text = "Buy Travel", command = lambda : passenger_dashboard(user_id), bg = "#DCEDC8").grid(row = 1, column = 0)
    tk.Button(super_admin_dashboard_page, text = "Questions", command = questions, bg = "#DCEDC8").grid(row = 2, column = 0)

#####################################################################################################################################

#travel agency dashboard
def travel_agency_dashboard(user_id):

    #finding managers agency_name
    cursor = my_database.cursor()
    query = "SELECT agency_name FROM user JOIN agency ON user.user_id = agency.agency_manager_id WHERE user_id = %s"
    values = (user_id, )
    cursor.execute(query, values)
    the_agency_name = cursor.fetchone()
    the_agency_name = the_agency_name[0]

    def build_discount():
        #creating a discount code
        def submit():
            discount_percentage = discount.get()
            cursor = my_database.cursor() 
            query = "INSERT INTO discount (discount_percentage) VALUES (%s)" 
            cursor.execute(query, (int(discount_percentage), )) 
            my_database.commit()
            messagebox.showinfo("Success", "New discount code is submitted! \U0001F607")
        discount_page = tk.Toplevel(manager_dashboard_page)
        #all available discounts
        cursor = my_database.cursor() 
        query = "SELECT DISTINCT discount.discount_id, discount.discount_percentage FROM discount" 
        cursor.execute(query) 
        discount_df = pd.DataFrame(cursor.fetchall(), columns = [desc[0] for desc in cursor.description])
        discount_df["discount_percentage"] = discount_df["discount_percentage"].astype(str) + "%"
        frame = tk.Frame(discount_page) 
        frame.grid(row = 0, column = 0) 
        table = Table(frame, dataframe = discount_df, showtoolbar = True, showstatusbar = True) 
        table.show() 
        tk.Label(discount_page, text = "Enter new discount percentage if you want to add a new discount code : ").grid(row = 1, column = 1)
        discount = tk.Entry(discount_page)
        discount.grid(row = 1, column = 2) 
        tk.Button(discount_page, text = "Submit", command = submit).grid(row = 1, column = 3)      
    
    #creating a new travel 
    def build_travel():
        def build():
            vehicle = vehicle_var.get()
            origin = origin_var.get() 
            destination = destination_var.get() 
            date = str(year_var.get()) + "-" + str(month_var.get()) + "-" + str(day_var.get())
            date_obj = datetime.strptime(date, "%Y-%B-%d") 
            formatted_date = date_obj.strftime("%Y-%m-%d")
            agency = str(the_agency_name)
            is_domestic = domestic_var.get()
            duration = duration_var.get()
            price = cost.get()
            available_seat = seat_var.get()

            vehicle_mapping = {"Bus" : 101, "AirPlane" : 102, "Train" : 103, "Ship" : 104} 
            vehicle_id = vehicle_mapping.get(vehicle, None) 

            travel_type_domestic_mapping = {"True" : True, "False" : False} 
            travel_type_domestic = travel_type_domestic_mapping.get(is_domestic, None) 
            

            agency_name_mapping = {"Travel World" : 1, "Global Voyagers" : 2,
                                    "Adventure Explorers" : 3, "Dream Destinations" : 4, "Sunshine Holidays" : 5, 
                                    "Wanderlust Travel" : 6,"Paradise Escapes" : 7, "Exotic Journeys" : 8, 
                                    "Luxury Getaways" : 9, "Magical Memories" : 10} 
            agency_id = agency_name_mapping.get(agency, None)
 
            query = """ 
                    INSERT INTO travel (vehicle_id, agency_id, travel_type_domestic, date, duration, origin, destination, price, available_seats)  
                    VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s) 
                """ 
            cursor.execute(query, (vehicle_id, agency_id, travel_type_domestic, formatted_date, duration, origin, destination, float(price), int(available_seat))) 
            my_database.commit()
            messagebox.showinfo("Success", "Travel added successfully! \U0001F607")

        build_travel_page = tk.Toplevel(manager_dashboard_page)

        cities = [
            "Tehran", "Mashhad", "Isfahan", "Karaj", "Tabriz", "Shiraz", "Qom", "Ahvaz", "Kermanshah", "Urmia",
            "Rasht", "Zahedan", "Kerman", "Hamedan", "Yazd", "Arak", "Ardabil", "Bandar Abbas", "Qazvin", "Zanjan",
            "New York City", "London", "Paris", "Tokyo", "Berlin", "Sydney", "Rome", "Beijing", "Moscow", "Cairo",
            "Dubai", "Toronto", "Bangkok", "Istanbul", "Amsterdam", "Rio de Janeiro", "Cape Town", "Mumbai",
            "Buenos Aires", "Singapore"
        ]
        vehicle_list = ["Bus", "AirPlane", "Train", "Ship"]
        vehicle_var = tk.StringVar(build_travel_page)
        vehicle_var.set(vehicle_list[0])
        tk.Label(build_travel_page, text = "Select vehicle : ").grid(row = 0, column = 0)
        vehicle_option = tk.OptionMenu(build_travel_page, vehicle_var, *vehicle_list)
        vehicle_option.grid(row = 0, column = 1)

        is_domestic = ["True", "False"]
        domestic_var = tk.StringVar(build_travel_page)
        domestic_var.set(is_domestic[0])
        tk.Label(build_travel_page, text = "Is travel domestic ? ").grid(row = 2, column = 0)
        domestic_option = tk.OptionMenu(build_travel_page, domestic_var, *is_domestic)
        domestic_option.grid(row = 2, column = 1)  

        origin_list = cities
        origin_var = tk.StringVar(build_travel_page)
        origin_var.set(origin_list[0])
        origin_label = tk.Label(build_travel_page, text = "Choose origin : ").grid(row = 3, column = 0)
        origin_option = tk.OptionMenu(build_travel_page, origin_var, *origin_list)
        origin_option.grid(row = 3, column = 1)
        destination_list = cities
        destination_var = tk.StringVar(build_travel_page)
        destination_var.set(destination_list[0])
        destination_label = tk.Label(build_travel_page, text = "Choose destination : ").grid(row = 4, column = 0)
        destination_option = tk.OptionMenu(build_travel_page, destination_var, *destination_list)
        destination_option.grid(row = 4, column = 1)

        tk.Label(build_travel_page, text = "Select date : ").grid(row = 5, column = 0)

        year = list(range(2023, 1939, -1))
        year_var = tk.StringVar(build_travel_page)
        year_var.set(year[0])
        tk.Label(build_travel_page, text = "Year : ").grid(row = 5, column = 1) 
        year_option = tk.OptionMenu(build_travel_page, year_var, *year)
        year_option.grid(row = 5, column = 2)
        months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
        month_var = tk.StringVar(build_travel_page)
        month_var.set(months[0])
        tk.Label(build_travel_page, text = "Month : ").grid(row = 6, column = 1) 
        month_option = tk.OptionMenu(build_travel_page, month_var, *months)
        month_option.grid(row = 6, column = 2)
        day = list(range(1, 32))
        day_var = tk.StringVar(build_travel_page)
        day_var.set(day[0])
        tk.Label(build_travel_page, text = "Day : ").grid(row = 7, column = 1)
        day_option = tk.OptionMenu(build_travel_page, day_var, *day)
        day_option.grid(row = 7, column = 2)

        duration = list(range(1, 25))
        duration_var = tk.StringVar(build_travel_page)
        duration_var.set(duration[0])
        tk.Label(build_travel_page, text = "Duration (in Hours) : ").grid(row = 8, column = 0) 
        duration_option = tk.OptionMenu(build_travel_page, duration_var, *duration)
        duration_option.grid(row = 8, column = 1)

        tk.Label(build_travel_page, text = "Enter travel cost : ").grid(row = 9, column = 0)
        cost = tk.Entry(build_travel_page)
        cost.grid(row = 9, column = 1)

        seats = list(range(20,401,20))
        seat_var = tk.StringVar(build_travel_page)
        seat_var.set(seats[0])
        tk.Label(build_travel_page, text = "Available seats : ").grid(row = 10, column = 0) 
        seat_option = tk.OptionMenu(build_travel_page, seat_var, *seats)
        seat_option.grid(row = 10, column = 1)
        tk.Button(build_travel_page, text = "Build", command = build).grid(row = 11, column = 0)

    #showing all travels of that agency
    def all_travels():
        all_travel_page = tk.Toplevel(manager_dashboard_page)
        my_cursor = my_database.cursor() 
        query = """ 
        SELECT travel.travel_id, travel.travel_type_domestic, travel.date, travel.duration, travel.origin, travel.destination, travel.price, travel.available_seats, vehicle.vehicle_type, agency.agency_name 
        FROM travel JOIN agency ON travel.agency_id = agency.agency_id JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id 
        WHERE agency.agency_name = %s 
        """ 
        my_cursor.execute(query, (the_agency_name, )) 
        result = my_cursor.fetchall() 
        columns = [desc[0] for desc in my_cursor.description] 
        all_travels_df = pd.DataFrame(result, columns = columns)
        all_travels_df["travel_type_domestic"] = all_travels_df["travel_type_domestic"].replace({1 : True, 0 : False})
        frame = tk.Frame(all_travel_page) 
        frame.grid(row = 0, column = 0) 
        table = Table(frame, dataframe = all_travels_df, showtoolbar = True, showstatusbar = True) 
        table.show()

    #filtering by rate
    def filter_by_rate():
        def search():
            search_page = tk.Toplevel(filter_rate_page)
            min_rate = int(min_rate_var.get())
            max_rate = int(max_rate_var.get())
            query = f''' 
                SELECT ticket.travel_id, AVG(ticket.rate) AS mean_rate, vehicle.vehicle_type, agency.agency_name, travel.travel_type_domestic, travel.date, travel.duration, travel.origin, travel.destination, travel.price 
                FROM ticket JOIN travel ON ticket.travel_id = travel.travel_id JOIN agency ON travel.agency_id = agency.agency_id JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id 
                WHERE ticket.rate IS NOT NULL AND agency.agency_name = '{the_agency_name}' 
                GROUP BY ticket.travel_id 
                HAVING mean_rate >= {min_rate} AND mean_rate <= {max_rate}
                ORDER BY mean_rate; 
            '''
            filtered_rate_df = pd.read_sql_query(query, my_database)
            frame = tk.Frame(search_page) 
            frame.grid(row = 0, column = 0) 
            table = Table(frame, dataframe = filtered_rate_df, showtoolbar = True, showstatusbar = True) 
            table.show() 

        filter_rate_page = tk.Toplevel(manager_dashboard_page)
        min_rates = list(range(1, 6))
        min_rate_var = tk.StringVar(filter_rate_page)
        min_rate_var.set(min_rates[0])
        tk.Label(filter_rate_page, text = "Min rate : ").grid(row = 0, column = 0)
        min_rate_option = tk.OptionMenu(filter_rate_page, min_rate_var, *min_rates)
        min_rate_option.grid(row = 0, column = 1)

        max_rates = list(range(1, 6))
        max_rate_var = tk.StringVar(filter_rate_page)
        max_rate_var.set(max_rates[0])
        tk.Label(filter_rate_page, text = "Max rate : ").grid(row = 1, column = 0)
        max_rate_option = tk.OptionMenu(filter_rate_page, max_rate_var, *max_rates)
        max_rate_option.grid(row = 1, column = 1)
        tk.Button(filter_rate_page, text = "Search", command = search).grid(row = 2, column = 0)

    #filtering by price
    def filter_by_price():
        def search():
            show_result_page=tk.Toplevel(filter_cost_page)
            min_cost = int(min_cost_var.get()) 
            max_cost = int(max_cost_var.get()) 
            my_cursor = my_database.cursor() 
            query = """ 
                SELECT travel.travel_id, travel.travel_type_domestic, travel.date, travel.duration, travel.origin, travel.destination, travel.price, travel.available_seats, vehicle.vehicle_type, agency.agency_name 
                FROM travel JOIN agency ON travel.agency_id = agency.agency_id JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id 
                WHERE agency.agency_name = %s AND travel.price >= %s AND travel.price <= %s 
                ORDER BY Travel.price
            """ 
            my_cursor.execute(query, (the_agency_name, min_cost, max_cost)) 
            result = my_cursor.fetchall() 
            columns = [desc[0] for desc in my_cursor.description] 
            cost_travels_df = pd.DataFrame(result, columns = columns)
            frame = tk.Frame(show_result_page) 
            frame.grid(row = 0, column = 0) 
            table = Table(frame, dataframe = cost_travels_df, showtoolbar = True, showstatusbar = True) 
            table.show() 
            
        filter_cost_page=tk.Toplevel(manager_dashboard_page)
        tk.Label(filter_cost_page, text = "Min cost : ").grid(row = 0, column = 0)
        min_cost_var = tk.Entry(filter_cost_page)
        min_cost_var.grid(row = 0, column = 1)
        tk.Label(filter_cost_page, text = "Max cost : ").grid(row = 1, column = 0)
        max_cost_var = tk.Entry(filter_cost_page)
        max_cost_var.grid(row = 1, column = 1)
        tk.Button(filter_cost_page, text = "Search", command = search).grid(row = 2, column = 0) 

    #filtering by time
    def filter_by_time():
        def search():
            show_result_page = tk.Toplevel(filter_time_page)
            start_date = str(start_year_var.get()) + "-" + str(start_month_var.get()) + "-" + str(start_day_var.get())
            start_date_obj = datetime.strptime(start_date, "%Y-%B-%d") 
            min_date = start_date_obj.strftime("%Y-%m-%d")
            end_date = str(end_year_var.get()) + "-" + str(end_month_var.get()) + "-" + str(end_day_var.get())
            end_date_obj = datetime.strptime(end_date, "%Y-%B-%d") 
            max_date = end_date_obj.strftime("%Y-%m-%d")            
            min_date = datetime.strptime(min_date, "%Y-%m-%d").date()
            max_date = datetime.strptime(max_date, "%Y-%m-%d").date()

            my_cursor = my_database.cursor() 
            query = """ 
            SELECT travel.travel_id, travel.travel_type_domestic, travel.date, travel.duration, travel.origin, travel.destination, travel.price, travel.available_seats, vehicle.vehicle_type, agency.agency_name 
            FROM travel JOIN agency ON travel.agency_id = agency.agency_id JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id 
            WHERE agency.agency_name = %s AND travel.date BETWEEN %s AND %s 
            ORDER BY travel.date
            """ 
            my_cursor.execute(query, (the_agency_name, min_date, max_date)) 
            result = my_cursor.fetchall() 
            columns = [desc[0] for desc in my_cursor.description] 
            date_df = pd.DataFrame(result, columns = columns)
            frame = tk.Frame(show_result_page) 
            frame.grid(row = 0, column = 0) 
            table = Table(frame, dataframe = date_df, showtoolbar = True, showstatusbar = True) 
            table.show()

        filter_time_page = tk.Toplevel(manager_dashboard_page)
        tk.Label(filter_time_page, text = "Start date : ").grid(row = 0, column = 0)
        start_year = list(range(2023, 1939, -1))
        start_year_var = tk.StringVar(filter_time_page)
        start_year_var.set(start_year[0])
        tk.Label(filter_time_page, text = "start Year : ").grid(row = 1, column = 1) 
        start_year_option = tk.OptionMenu(filter_time_page, start_year_var, *start_year)
        start_year_option.grid(row = 1, column = 2)
        start_months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
        start_month_var = tk.StringVar(filter_time_page)

        start_month_var.set(start_months[0])
        tk.Label(filter_time_page, text = "Start Month : ").grid(row = 2, column = 1) 
        start_month_option = tk.OptionMenu(filter_time_page, start_month_var, *start_months)
        start_month_option.grid(row = 2, column = 2)
        start_day = list(range(1, 32))
        start_day_var = tk.StringVar(filter_time_page)
        start_day_var.set(start_day[0])
        tk.Label(filter_time_page, text = "Start Day : ").grid(row = 3, column = 1)
        start_day_option = tk.OptionMenu(filter_time_page, start_day_var, *start_day)
        start_day_option.grid(row = 3, column = 2)

        tk.Label(filter_time_page, text = "End Date : ").grid(row = 4, column = 0)
        end_year = list(range(2023, 1939, -1))
        end_year_var = tk.StringVar(filter_time_page)
        end_year_var.set(end_year[0])
        tk.Label(filter_time_page, text = "End Year : ").grid(row = 5, column = 1) 
        end_year_option = tk.OptionMenu(filter_time_page, end_year_var, *end_year)
        end_year_option.grid(row = 5, column = 2)
        end_months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
        end_month_var = tk.StringVar(filter_time_page)

        end_month_var.set(end_months[0])
        tk.Label(filter_time_page, text = "End Month : ").grid(row = 6, column = 1) 
        end_month_option = tk.OptionMenu(filter_time_page, end_month_var, *end_months)
        end_month_option.grid(row = 6, column = 2)
        end_day = list(range(1, 32))
        end_day_var = tk.StringVar(filter_time_page)
        end_day_var.set(end_day[0])
        tk.Label(filter_time_page, text = "End Day : ").grid(row = 7, column = 1)
        end_day_option = tk.OptionMenu(filter_time_page, end_day_var, *end_day)
        end_day_option.grid(row = 7, column = 2)
        tk.Button(filter_time_page, text = "Search", command = search).grid(row = 8, column = 1) 

    #list of passengers and their travel information
    def passenger_travels():
        passenger_travel_page = tk.Toplevel(manager_dashboard_page)
        my_cursor = my_database.cursor() 
        query = """ 
            SELECT travel.travel_id, agency.agency_name, vehicle.vehicle_type, user.user_id, user.gender_id, user.first_name, user.last_name, user.birth_date, user.phone_number, user.email_address 
            FROM travel JOIN agency ON travel.agency_id = agency.agency_id JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id JOIN ticket ON travel.travel_id = ticket.travel_id JOIN user ON ticket.user_id = user.user_id 
            WHERE agency.agency_name = %s 
        """ 
        my_cursor.execute(query, (the_agency_name, )) 
        result = my_cursor.fetchall() 
        passengers_travels_df = pd.DataFrame(result, columns = ["travel_id", "agency_name", "vehicle_type", "user_id", "gender_id", "first_name", "last_name", "birth_date", "phone_number", "email_address"])
        frame = tk.Frame(passenger_travel_page) 
        frame.grid(row = 0, column = 0) 
        table = Table(frame, dataframe = passengers_travels_df, showtoolbar = True, showstatusbar = True) 
        table.show() 

    #best selling travel
    def best_sell_travel():
        best_sell_travel_page = tk.Toplevel(manager_dashboard_page)
        my_cursor = my_database.cursor()  
        query = """  
        SELECT travel.travel_id, agency.agency_name, vehicle.vehicle_type, user.user_id, user.gender_id, user.first_name, user.last_name, user.birth_date, user.phone_number, user.email_address  
        FROM travel  
        JOIN agency ON travel.agency_id = agency.agency_id  
        JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id  
        JOIN ticket ON travel.travel_id = ticket.travel_id  
        JOIN user ON ticket.user_id = user.user_id  
        WHERE agency.agency_name = %s  
        """  
        my_cursor.execute(query, (the_agency_name, ))  
        result = my_cursor.fetchall()  
        passengers_travels_df = pd.DataFrame(result, columns = ["travel_id", "agency_name", "vehicle_type", "user_id", "gender_id", "first_name", "last_name", "birth_date", "phone_number", "email_address"]) 
        passengers_travels_df["occurrences"] = passengers_travels_df.groupby("travel_id")["travel_id"].transform("count")
        grouped_df = passengers_travels_df.groupby("travel_id").size().reset_index(name = "occurrences") 
        distinct_df = grouped_df.drop_duplicates() 
        frame = tk.Frame(best_sell_travel_page)  
        frame.grid(row = 0, column = 0)  
        table = Table(frame, dataframe = distinct_df, showtoolbar = True, showstatusbar = True)  
        table.show()

    #highest average rated travels
    def highest_rating_travel():
        highest_rating_travel_page = tk.Toplevel(manager_dashboard_page)
        query = f''' 
            SELECT t.travel_id, t.mean_rate, t.vehicle_type, t.agency_name, t.travel_type_domestic, t.date, t.duration, t.origin, t.destination, t.price 
            FROM ( 
                SELECT ticket.travel_id, AVG(ticket.rate) AS mean_rate, vehicle.vehicle_type, agency.agency_name, travel.travel_type_domestic, travel.date, travel.duration, travel.origin, travel.destination, travel.price 
                FROM ticket 
                JOIN travel ON ticket.travel_id = travel.travel_id 
                JOIN agency ON travel.agency_id = agency.agency_id 
                JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id 
                WHERE ticket.rate IS NOT NULL AND agency.agency_name = '{the_agency_name}' 
                GROUP BY ticket.travel_id 
            ) AS t 
            JOIN ( 
                SELECT MAX(mean_rate) AS max_mean_rate 
                FROM ( 
                    SELECT AVG(rate) AS mean_rate 
                    FROM ticket 
                    WHERE rate IS NOT NULL 
                    GROUP BY travel_id 
                ) AS subquery 
            ) AS max_rates ON t.mean_rate = max_rates.max_mean_rate 
        ''' 
        filtered_rate_df = pd.read_sql_query(query, my_database) 
        frame = tk.Frame(highest_rating_travel_page) 
        frame.grid(row = 0, column = 0) 
        table = Table(frame, dataframe = filtered_rate_df, showtoolbar = True, showstatusbar = True) 
        table.show()

        #plotting above table
        query = f'''  
            SELECT ticket.travel_id, AVG(ticket.rate) AS mean_rate, vehicle.vehicle_type, agency.agency_name, travel.travel_type_domestic, travel.date, travel.duration, travel.origin, travel.destination, travel.price  
            FROM ticket JOIN travel ON ticket.travel_id = travel.travel_id JOIN agency ON travel.agency_id = agency.agency_id JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id  
            WHERE ticket.rate IS NOT NULL AND agency.agency_name = '{the_agency_name}'  
            GROUP BY ticket.travel_id  
            ORDER BY mean_rate; 
        ''' 
        filtered_rate_all_df = pd.read_sql_query(query, my_database) 
        sns.set_style("whitegrid") 
        ax = sns.barplot(x = "travel_id", y = "mean_rate", data = filtered_rate_all_df, color = "blue") 
        max_rate = filtered_rate_all_df["mean_rate"].max() 
        max_rate_index = filtered_rate_all_df["mean_rate"].idxmax() 
        ax.patches[max_rate_index].set_facecolor("goldenrod") 
        plt.show()

    #most popular destinations
    def most_popular_destination():
        most_popular_destination_page = tk.Toplevel(manager_dashboard_page)
        my_cursor = my_database.cursor()  
        query = """  
            SELECT travel.destination, COUNT(*) AS count 
            FROM travel  JOIN agency ON travel.agency_id = agency.agency_id JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id JOIN ticket ON travel.travel_id = ticket.travel_id JOIN user ON ticket.user_id = user.user_id  
            WHERE agency.agency_name = %s  
            GROUP BY travel.destination 
        """  
        my_cursor.execute(query, (the_agency_name, ))  
        result = my_cursor.fetchall()  
        most_destination_df = pd.DataFrame(result, columns = ["destination", "count"]) 
        most_all_destination_df = most_destination_df.copy() 
        max_count = most_destination_df["count"].max() 
        df_filtered = most_destination_df[most_destination_df["count"] == max_count] 
        df_filtered = df_filtered.drop_duplicates()
        frame = tk.Frame(most_popular_destination_page)  
        frame.grid(row = 0, column = 0)  
        table = Table(frame, dataframe = df_filtered, showtoolbar = True, showstatusbar = True)  
        table.show()
        #plotting above table 
        plt.figure(figsize = (10, 6)) 
        sns.barplot(x = "destination", y = "count", data = most_all_destination_df, ci = None) 
        for index, row in most_all_destination_df.iterrows(): 
            plt.text(index, row["count"], str(row["count"]), ha = "center", va = "bottom") 
        plt.xlabel("Destination") 
        plt.ylabel("Count") 
        plt.title("Count of Passengers by Destination") 
        plt.xticks(rotation = 45) 
        plt.tight_layout() 
        plt.show()

    #top 5 passengers based on their max amount of money they've spent
    def top_5_passengers():
        def show():
            show_page=tk.Toplevel(top_5_passengers_page)
            min_date = str(year_var.get()) + "-" + str(month_var.get()) + "-" + "01"
            max_date = str(year_var.get()) + "-" + str(month_var.get()) + "-" + "31"
            date_obj_min = datetime.strptime(min_date, "%Y-%B-%d") 
            formatted_min_date = date_obj_min.strftime("%Y-%m-%d")
            date_obj_max = datetime.strptime(max_date, "%Y-%B-%d") 
            formatted_max_date = date_obj_max.strftime("%Y-%m-%d")
            my_cursor = my_database.cursor() 
            query = """ 
                SELECT user.user_id, CONCAT(user.first_name, ' ', user.last_name) AS full_name, user.phone_number, user.email_address, SUM(travel.price) AS total_count, COUNT(travel.destination) AS destination_count 
                FROM travel 
                JOIN agency ON travel.agency_id = agency.agency_id 
                JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id 
                JOIN  ticket ON travel.travel_id = ticket.travel_id 
                JOIN user ON ticket.user_id = user.user_id 
                WHERE agency.agency_name = %s AND travel.date BETWEEN %s AND %s 
                GROUP BY user.user_id, full_name, user.phone_number, user.email_address
                ORDER BY total_count DESC 
                LIMIT 5; 
            """
            my_cursor.execute(query, (the_agency_name, formatted_min_date, formatted_max_date)) 
            result = my_cursor.fetchall() 
            columns = [desc[0] for desc in my_cursor.description] 
            top_five_df = pd.DataFrame(result, columns = columns)
            frame = tk.Frame(show_page)  
            frame.grid(row = 0, column = 0)  
            table = Table(frame, dataframe = top_five_df, showtoolbar = True, showstatusbar = True)  
            table.show()
            #plotting above table
            top_five_df = top_five_df.sort_values("total_count", ascending = False)
            colors = ["#ffcc00" if x == top_five_df["total_count"].max() else "#0077cc" for x in top_five_df["total_count"]] 
            sns.barplot(x = "total_count", y = "full_name", data = top_five_df, palette = colors) 
            for i in range(len(top_five_df)): 
                plt.text(top_five_df["total_count"].iloc[i], i, str(top_five_df["total_count"].iloc[i]), va = "center") 
            plt.show()

        top_5_passengers_page = tk.Toplevel(manager_dashboard_page)
        year = list(range(2023, 1939, -1))
        year_var = tk.StringVar(top_5_passengers_page)
        year_var.set(year[0])
        tk.Label(top_5_passengers_page, text = "Year : ").grid(row = 0, column = 0) 
        year_option = tk.OptionMenu(top_5_passengers_page, year_var, *year)
        year_option.grid(row = 0, column = 1)
        months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
        month_var = tk.StringVar(top_5_passengers_page)
        month_var.set(months[0])
        tk.Label(top_5_passengers_page, text = "Month : ").grid(row = 0, column = 2) 
        month_option = tk.OptionMenu(top_5_passengers_page, month_var, *months)
        month_option.grid(row = 0, column = 3)
        tk.Button(top_5_passengers_page, text = "Show", command = show).grid(row = 1, column = 4)

    #gender ratio        
    def gender_ratio():
        gender_ratio_page = tk.Toplevel(manager_dashboard_page)
        my_cursor = my_database.cursor() 
        query = """ 
            SELECT DISTINCT user.gender_id, COUNT(*) AS gender_sum 
            FROM travel JOIN agency ON travel.agency_id = agency.agency_id JOIN vehicle ON travel.vehicle_id = vehicle.vehicle_id JOIN ticket ON travel.travel_id = ticket.travel_id JOIN user ON ticket.user_id = user.user_id 
            WHERE agency.agency_name = %s 
            GROUP BY user.gender_id 
        """ 
        my_cursor.execute(query, (the_agency_name, )) 
        result = my_cursor.fetchall() 
        sum_gender_df = pd.DataFrame(result, columns = ["gender_id", "gender_sum"]) 
        sum_gender_df["gender_id"] = sum_gender_df["gender_id"].replace({1 : "Male", 2 : "Female", 3 : "N/A"})
        frame = tk.Frame(gender_ratio_page) 
        frame.grid(row = 0, column = 0) 
        table = Table(frame, dataframe = sum_gender_df, showtoolbar = True, showstatusbar = True) 
        table.show()  
        #plotting above table
        plt.figure(figsize = (6, 6))
        plt.pie(
            sum_gender_df["gender_sum"],
            labels = sum_gender_df["gender_id"],
            autopct = lambda p : f'{p:.1f}% -> ({int(float(p) * float(sum(sum_gender_df["gender_sum"])) / 100)})',
            startangle = 90,
            colors = ["#FF521B", "#FC9E4F", "#EDD382"]
        )
        plt.title("Gender Distribution")
        plt.axis("equal")
        plt.show()

    #managers as  super admin to chat
    def chat_panel():
        super_admin_dashboard(user_id)

    #managers information
    def personal_info_page():
        query = """ 
        SELECT user.first_name, user.last_name, gender.gender_title, user.birth_date, user.phone_number, user.email_address, user.password, user.account_asset, agency.agency_name
        FROM user JOIN gender ON user.gender_id = gender.gender_id JOIN agency ON user.user_id = agency.agency_manager_id
        WHERE user.user_id = %s
        """ 
        cursor.execute(query, (user_id, ))
        result = cursor.fetchall()
        passenger_info_page = tk.Toplevel(manager_dashboard_page)
        tk.Label(passenger_info_page, text = "First Name : " + result[0][0]).grid(row = 0, column = 0,sticky = tk.W)
        tk.Label(passenger_info_page, text = "Last Name : " + result[0][1]).grid(row = 1, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Gender : " + result[0][2]).grid(row = 2, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Birth Date : " + str(result[0][3])).grid(row = 3, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Phone Number : " + result[0][4]).grid(row = 4, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Email Address : " + result[0][5]).grid(row = 5, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Account Asset : " + str(result[0][7])).grid(row = 6, column = 0, sticky = tk.W)
        tk.Label(passenger_info_page, text = "Agency : " + str(result[0][8])).grid(row = 7, column = 0, sticky = tk.W)
    
    manager_dashboard_page = tk.Toplevel(root)
    
    tk.Button(manager_dashboard_page, text = "Personal information", command = personal_info_page, bg = "#4B8BBE").grid(row = 0, column = 0)
    tk.Button(manager_dashboard_page, text = "Chat Panel", command = chat_panel, bg = "#4B8BBE").grid(row = 0, column = 1)
    tk.Button(manager_dashboard_page, text = "Build Travel", command = build_travel, bg = "#306998").grid(row = 1, column = 0)
    tk.Button(manager_dashboard_page, text = "Buy Travel", command = lambda: passenger_dashboard(user_id), bg = "#306998").grid(row = 1, column = 1)
    tk.Button(manager_dashboard_page, text = "Build Discount", command = build_discount, bg = "#306998").grid(row = 1, column = 2)
    tk.Label(manager_dashboard_page, text = "Filter travels by : ").grid(row = 2, column  = 0)
   
    tk.Button(manager_dashboard_page, text = "All travels", command = all_travels, bg = "#FFE873").grid(row = 2, column = 1)
    tk.Button(manager_dashboard_page, text = "Rate", command = filter_by_rate, bg = "#FFE873").grid(row = 2, column = 2)
    tk.Button(manager_dashboard_page, text = "Price", command = filter_by_price, bg = "#FFE873").grid(row = 2, column = 3)
    tk.Button(manager_dashboard_page, text = "Date", command = filter_by_time, bg = "#FFE873").grid(row = 2, column = 4)
    tk.Button(manager_dashboard_page, text = "Passengers Travels", command = passenger_travels, bg = "#FFE873").grid(row = 2, column = 5)
    tk.Label(manager_dashboard_page, text = "Stats : ").grid(row = 3, column = 0)
    tk.Button(manager_dashboard_page, text = "Best Sell Travel", command = best_sell_travel, bg = "#FFD438").grid(row = 3, column = 1)
    tk.Button(manager_dashboard_page, text = "Highest Rating", command = highest_rating_travel, bg = "#FFD438").grid(row = 3, column = 2)
    tk.Button(manager_dashboard_page, text = "Most Popular Destination", command = most_popular_destination, bg = "#FFD438").grid(row = 3, column = 3)
    tk.Button(manager_dashboard_page, text = "Top 5 Passengers", command = top_5_passengers, bg = "#FFD438").grid(row = 3, column = 4)
    tk.Button(manager_dashboard_page, text = "Gender Ratio", command = gender_ratio, bg = "#FFD438").grid(row = 3, column = 5)

#####################################################################################################################################

#signup page -> many to many functions are because of window in window tabs
def signup():                 
    def submit_data():
        def otp():
            def save_otp(our_otp):
                global otp_code
                otp_code = our_otp
                #checking validation of otp and adding passengers information to database if otp is correct
                if(otp_code == str(verification_code)):
                    generate_hash = lambda name : hashlib.sha256(name.encode("utf-8")).hexdigest()
                    hashed_password = generate_hash(password)
                    query = """ 
                        INSERT INTO user (role_id, discount_id, gender_id, first_name, last_name, birth_date, phone_number, email_address, password, account_asset) 
                        VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s) 
                    """ 
                    cursor.execute(query, (1, 1, gender, first_name, last_name, formatted_date, "+98" + phone_number, email, hashed_password, 0)) 
                    my_database.commit()
                    messagebox.showinfo("correct", "*Signed up successfully! \U0001F607")
                #error message for passenger information if otp is wrong
                else:
                    messagebox.showerror("Error", "*OTP is not correct! \U0001F612")

            #creating valid one time password window for 30 seconds!
            otp_page = tk.Toplevel(signup_page)
            otp_label = tk.Label(otp_page, text = "Please check the text file and fill the code section:", fg = "blue")
            otp_label.grid(row = 1, column = 0)
            tk.Label(otp_page, text = "code:").grid(row = 2, column = 0)
            otp_entry = tk.Entry(otp_page)
            otp_entry.grid(row = 2, column = 1)
            otp_page.after(30000, otp_page.destroy)
            #generate 4 digit otp in a text file
            verification_code = random.randint(1000, 9999)
            with open("Verification_Code.txt", "w") as file:  
                file.write(str(verification_code))
            tk.Button(otp_page, text = "Ok", command = lambda : save_otp(otp_entry.get())).grid(row = 3, column = 0)
            tk.Button(otp_page, text = "close", command = otp_page.destroy).grid(row = 3, column = 1)

        #changing passengers information in correct format 
        first_name = firstname_entry.get()                                         
        last_name = lastname_entry.get()
        gender = gender_var.get()
        gender_map = {"Male" : 1, "Female" : 2, "N/A" : 3}
        gender = gender_map.get(gender, None)
        phone_number = phone_number_entry.get()
        password = password_entry.get()
        email = email_entry.get()
        birth_day = str(birth_year_var.get()) + "-" + str(birth_month_var.get()) + "-" + str(birth_day_var.get())
        date_obj = datetime.strptime(birth_day, "%Y-%B-%d") 
        formatted_date = date_obj.strftime("%Y-%m-%d")

        #checking validity of provided information using regex
        if (bool(re.match(r"^[a-zA-Z]{3,30}$", first_name))) == False:
            messagebox.showerror("Error", "First Name ->\nIt must only contain characters!\nThe length must be between 3 and 30! \U0001F612")
        elif (bool(re.match(r"^[a-zA-Z]{3,30}$", last_name))) == False:
            messagebox.showerror("Error", "Last Name ->\nIt must only contain characters!\nThe length must be between 3 and 30! \U0001F612")
        elif (bool(re.match(r"^\d{10}$", str(phone_number)))) == False:
            messagebox.showerror("Error", "Phone Number ->\nIt must only contain 10 digits! \U0001F612")
        elif (bool(re.match(r"^[\w\.-]+@[\w\.-]+\.\w+$", email))) == False:
            messagebox.showerror("Error", "Email Address ->\nThe Email is not valid! \U0001F612")
        elif (bool(re.match(r"^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]{5,20}$", password))) == False:
            messagebox.showerror("Error", "Password ->\nIt must contain both characters and digits!\nThe length must be between 5 and 20! \U0001F612")
        else:
            #if provided information was valid, we'll send the one time password
            otp()

    #signup page -> getting passengers information 
    signup_page = tk.Toplevel(root)
    root.destroy
    get_fname = tk.Label(signup_page, text = "First Name:") #getting first name
    get_fname.grid(row = 1,column = 1)
    firstname_entry = tk.Entry(signup_page)
    firstname_entry.grid(row = 1, column = 2)
    tk.Label(signup_page,text = "**** It must only contain characters ****", fg = "green").grid(row = 1, column = 3)

    get_lname = tk.Label(signup_page, text = "Last Name:") #getting last name
    get_lname.grid(row = 2, column = 1)
    lastname_entry = tk.Entry(signup_page)
    lastname_entry.grid(row = 2, column = 2)
    tk.Label(signup_page, text = "**** It must only contain characters ****", fg = "green").grid(row = 2, column = 3)

    genders = ["Male", "Female", "N/A"]
    gender_var = tk.StringVar(signup_page)                                                      
    gender_var.set(genders[0])
    select_gender_label = tk.Label(signup_page, text = "Select Gender:").grid(row = 3, column = 1) #getting gender
    gender_option = tk.OptionMenu(signup_page, gender_var, *genders)
    gender_option.grid(row = 3, column = 2)

    birth_year = list(range(2023, 1939, -1))
    birth_year_var = tk.StringVar(signup_page)
    birth_year_var.set(birth_year[0])
    birthday_year_label = tk.Label(signup_page, text = "Select Year:").grid(row = 4, column = 1) #getting birth year
    birth_year_option = tk.OptionMenu(signup_page, birth_year_var, *birth_year)
    birth_year_option.grid(row = 4, column = 2)

    birth_months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
    birth_month_var = tk.StringVar(signup_page)
    birth_month_var.set(birth_months[0])
    birthday_month_label = tk.Label(signup_page, text = "Select Month:").grid(row = 5, column = 1) #getting birth month
    birth_month_option = tk.OptionMenu(signup_page, birth_month_var, *birth_months)
    birth_month_option.grid(row = 5, column = 2)

    birth_day = list(range(1, 32))
    birth_day_var = tk.StringVar(signup_page)
    birth_day_var.set(birth_day[0])
    birthday_day_label = tk.Label(signup_page, text = "Select Day:").grid(row = 6, column = 1) #getting birth day
    birth_day_option = tk.OptionMenu(signup_page, birth_day_var, *birth_day)
    birth_day_option.grid(row = 6, column = 2)

    get_phone_number = tk.Label(signup_page, text = "Phone Number: (+98)") #getting phone number
    get_phone_number.grid(row = 7, column = 1)
    phone_number_entry = tk.Entry(signup_page)
    phone_number_entry.grid(row = 7, column = 2)

    get_email = tk.Label(signup_page, text = "Email Address:") #getting email address
    get_email.grid(row = 8, column = 1)
    email_entry = tk.Entry(signup_page)
    email_entry.grid(row = 8, column = 2)

    get_password = tk.Label(signup_page, text = "Password:") #getting password
    get_password.grid(row = 9, column = 1)
    password_entry = tk.Entry(signup_page)
    password_entry.grid(row = 9, column = 2)

    #providing details about input data
    tk.Label(signup_page, text = "**** Password must contain both characters and digits and its length must be between 5 and 20 ****", fg = "green").grid(row = 9, column = 3)
    tk.Label(signup_page, text = "               ").grid(row = 10, column = 1)
    tk.Label(signup_page, text = "**** All fields must be filled ****", fg = "red").grid(row = 10, column = 2)

    #submit button
    button = tk.Button(signup_page, text = "submit", command = submit_data)
    button.grid(row = 11, column = 1)
    button = tk.Button(signup_page, text = "close", command = signup_page.destroy)                     
    button.grid(row = 11, column = 2)

#####################################################################################################################################

#main page
root = tk.Tk()
username_label = tk.Label(root, text = "Username : ")
username_label.grid(row = 1, column = 1)
username_entry = tk.Entry(root)
username_entry.grid(row = 1, column = 2)
password_label = tk.Label(root, text = "Password : ")
password_label.grid(row = 2, column = 1)
password_entry = tk.Entry(root, show = "*")
password_entry.grid(row = 2, column = 2)
login_button = tk.Button(root, text = "login", command = login).grid(row = 3, column = 2)
button = tk.Button(root, text = "signup", command = signup)
button.grid(row = 3, column = 1)
root.mainloop()

#####################################################################################################################################

#closing connection with mysql
cursor.close()
my_database.close()